<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PanesOS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tahoma', sans-serif;
        }
        
        body {
            overflow: hidden;
            background-color: #236B8E;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .desktop {
            flex: 1;
            background-image: url('https://dinkybeat.github.io/media/img/bliss.png');
            background-size: cover;
            background-position: center;
            position: relative;
            padding: 10px;
            overflow: hidden;
        }

        .desktop-icons {
            display: grid;
            grid-template-columns: repeat(1, 70px);
            grid-gap: 20px;
            padding: 10px;
            position: relative;
            z-index: 10;
        }
        
        .icon {
            width: 70px;
            text-align: center;
            cursor: pointer;
        }
        
        .icon img {
            width: 40px;
            height: 40px;
            margin-bottom: 5px;
        }
        
        .icon-text {
            color: white;
            font-size: 11px;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.8);
            background-color: rgba(0, 0, 0, 0.2);
            padding: 2px;
            border-radius: 2px;
        }
        
        .taskbar {
            height: 30px;
            background: linear-gradient(to bottom, #1C57C2 0%, #2A8BE2 5%, #2989D8 50%, #2580C7 95%, #2277BC 100%);
            display: flex;
            align-items: center;
            padding: 0 2px;
            position: relative;
            z-index: 100;
            border-top: 1px solid #5D9FD5;
        }
        
        .start-button {
            display: flex;
            align-items: center;
            background: linear-gradient(to bottom, #3C8F00 0%, #5FBB4D 5%, #58B548 50%, #4AA838 95%, #3C8F00 100%);
            height: 28px;
            border-radius: 3px;
            margin-right: 10px;
            padding: 0 5px;
            cursor: pointer;
            box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
        }
        
        .start-text {
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        .taskbar-divider {
            width: 1px;
            height: 20px;
            background-color: #1C57C2;
            margin: 0 5px;
        }
        
        .quick-launch {
            display: flex;
            align-items: center;
        }
        
        .taskbar-spacer {
            flex: 1;
        }
        
        .system-tray {
            display: flex;
            align-items: center;
            background-color: #0F80C4;
            height: 22px;
            padding: 0 5px;
            border-radius: 2px;
        }
        
        .time {
            color: white;
            font-size: 11px;
            margin-left: 5px;
        }
        
        /* Additional styling for a more authentic look */
        .icon.selected .icon-text {
            background-color: rgba(49, 106, 197, 0.4);
        }

        .taskbar-apps {
            display: flex;
            height: 28px;
            margin-left: 5px;
        }

        .taskbar-app {
            background: linear-gradient(to bottom, #2D91E3 0%, #2B8FDA 45%, #267ACD 55%, #2475C4 100%);
            border-radius: 2px;
            padding: 0 8px;
            margin-right: 3px;
            display: flex;
            align-items: center;
            cursor: pointer;
            max-width: 150px;
            color: white;
            font-size: 11px;
            box-shadow: inset 0 0 1px 1px rgba(255, 255, 255, 0.2);
        }
        
        /* Emoji styles */
        .emoji {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        a {
            text-decoration: none;
            color: inherit;
        }

        .start-emoji {
            font-size: 16px;
            margin-right: 3px;
        }

        .quick-launch-icon {
            font-size: 22px;
            margin-right: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app-emoji {
            font-size: 16px;
            margin-right: 5px;
        }

        .tray-emoji {
            font-size: 16px;
            margin-left: 5px;
        }

        /* Common Window Styles */
        .window {
            position: absolute;
            background-color: #ECE9D8;
            border: 1px solid #0055EA;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            border-radius: 3px 3px 0 0;
            display: none;
        }

        .titlebar {
            height: 28px;
            background: linear-gradient(to right, #0058E6, #2686E0, #7EB6E7);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            color: white;
            font-weight: bold;
            font-size: 13px;
            border-radius: 3px 3px 0 0;
            user-select: none;
        }

        .title {
            display: flex;
            align-items: center;
        }

        .title-emoji {
            margin-right: 6px;
            font-size: 16px;
        }

        .window-controls {
            display: flex;
        }

        .window-button {
            width: 21px;
            height: 21px;
            margin-left: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            border-radius: 3px;
        }

        .window-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .close-button {
            background-color: #FF4943;
            color: white;
            font-weight: bold;
        }

        /* Folder Window Styles */
        .folder-window {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 400px;
        }

        .folder-toolbar {
            height: 36px;
            background-color: #EBE8D8;
            border-bottom: 1px solid #D8D2BD;
            display: flex;
            align-items: center;
            padding: 0 10px;
        }

        .folder-toolbar-section {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }

        .folder-toolbar-button {
            display: flex;
            align-items: center;
            font-size: 12px;
            padding: 4px 8px;
            border: 1px solid transparent;
            cursor: pointer;
        }

        .folder-toolbar-button:hover {
            border: 1px solid #B1AEA0;
            background-color: #F7F5ED;
        }

        .folder-toolbar-emoji {
            margin-right: 3px;
            font-size: 14px;
        }

        .folder-addressbar {
            height: 24px;
            background-color: white;
            border: 1px solid #7F9DB9;
            margin: 5px 10px;
            display: flex;
            align-items: center;
            padding: 0 5px;
        }

        .folder-addressbar-label {
            font-size: 12px;
            margin-right: 5px;
        }

        .folder-addressbar-path {
            font-size: 12px;
            flex: 1;
        }

        .folder-main {
            flex: 1;
            display: flex;
            border-top: 1px solid #CCC;
        }

        .folder-sidebar {
            width: 180px;
            background-color: #ECE9D8;
            border-right: 1px solid #D8D2BD;
            padding: 10px 0;
        }

        .folder-sidebar-section {
            margin-bottom: 10px;
        }

        .folder-sidebar-header {
            font-size: 12px;
            font-weight: bold;
            color: #003399;
            padding: 5px 10px;
            background-color: #D8D2BD;
            margin-bottom: 5px;
        }

        .folder-sidebar-item {
            display: flex;
            align-items: center;
            padding: 3px 10px;
            cursor: pointer;
            font-size: 12px;
        }

        .folder-sidebar-item:hover {
            background-color: #D8D2BD;
        }

        .folder-sidebar-emoji {
            margin-right: 5px;
            font-size: 16px;
        }

        .folder-content {
            flex: 1;
            background-color: white;
            padding: 10px;
            overflow: auto;
        }

        .folder-file {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            margin: 5px;
            padding: 5px;
            cursor: pointer;
        }

        .folder-file:hover {
            background-color: #E8F1FC;
        }

        .folder-file-emoji {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .folder-file-name {
            font-size: 11px;
            text-align: center;
            word-break: break-word;
        }

        .folder-statusbar {
            height: 22px;
            background-color: #ECE9D8;
            border-top: 1px solid #D8D2BD;
            display: flex;
            align-items: center;
            padding: 0 10px;
            font-size: 11px;
        }

        /* Vinyl Player Window Styles */
        .vinyl-window {
            top: 20%;          /* Position it higher on the screen */
            left: 20%;         /* Position it more to the left */
            width: 1100px;     /* Increase from 900px to 1100px */
            height: 650px;     /* Increase from 520px to 650px */
            background-color: #121212;
        }

        .vinyl-container {
            display: flex;
            width: 100%;
            height: 600px;     /* Increase from 470px to 600px */
        }


        .player-container {
            position: relative;
            width: 700px;      /* Increase from 600px to 700px */
            height: 500px;     /* Increase from 400px to 500px */
            margin: 10px;
            perspective: 1200px;
        }
        
        .turntable {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.5s ease;
        }
        
        .player-base {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #222;
            transform: translateZ(-10px);
            border-radius: 10px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            border: 2px solid #333;
        }
        
        .platter {
            position: absolute;
            width: 350px;      /* Increase from 300px to 350px */
            height: 350px;     /* Increase from 300px to 350px */
            background-color: #111;
            border-radius: 50%;
            top: 75px;         /* Adjust position */
            left: 175px;       /* Adjust position */
            transform: translateZ(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        
        .record {
            position: absolute;
            width: 280px;
            height: 280px;
            background: 
                radial-gradient(circle at center, 
                    #000 0%, 
                    #000 38%, 
                    #333 38.5%, 
                    #333 39.5%, 
                    #000 40%, 
                    #000 42%, 
                    #333 42.5%, 
                    #333 43.5%, 
                    #000 44%, 
                    #000 46%, 
                    #333 46.5%, 
                    #333 47.5%, 
                    #000 48%, 
                    #000 50%, 
                    #333 50.5%, 
                    #333 51.5%, 
                    #000 52%, 
                    #000 54%, 
                    #333 54.5%, 
                    #333 55.5%, 
                    #000 56%,
                    #000 100%);
            border-radius: 50%;
            top: 10px;
            left: 10px;
            animation: rotate 5s linear infinite paused;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
        }
        
        .record.playing {
            animation-play-state: running;
        }
        
        .record-label {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            top: 90px;
            left: 90px;
            background-size: cover;
            background-position: center;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        .record-center {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #888;
            border-radius: 50%;
            top: 130px;
            left: 130px;
            transform: translateZ(7px);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.8);
        }
        
        .tonearm-base {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: #444;
            border-radius: 50%;
            top: 70px;
            right: 100px;
            transform: translateZ(15px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.5);
        }
        
        .tonearm {
            position: absolute;
            width: 180px;
            height: 10px;
            background-color: #555;
            top: 95px;
            right: 100px;
            transform-origin: right center;
            transform: rotate(-30deg) translateZ(17px);
            transition: transform 1s ease;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
        }
        
        .tonearm.playing {
            transform: rotate(15deg) translateZ(17px);
        }
        
        .cartridge {
            position: absolute;
            width: 20px;
            height: 15px;
            background-color: #333;
            left: 0;
            top: -5px;
            transform: translateZ(1px);
        }
        
        .controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }
        
        .control-button {
            width: 50px;
            height: 50px;
            background-color: #333;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: all 0.2s ease;
        }
        
        .control-button:hover {
            background-color: #444;
            transform: translateY(-2px);
        }
        
        .control-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .play-button {
            background-color: #00a651;
        }
        
        .album-display {
            position: absolute;
            width: 200px;
            height: 200px;
            top: 50px;
            left: -200px;
            perspective: 800px;
        }
        
        .album-cover {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
            transform: rotateY(20deg);
            transition: transform 0.5s ease;
        }
        
        .album-cover:hover {
            transform: rotateY(0deg);
        }
        
        .album-info {
            position: absolute;
            bottom: 50px;
            left: -200px;
            width: 200px;
            text-align: center;
            color: white;
        }
        
        .album-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .album-artist {
            font-size: 14px;
            color: #aaa;
        }
        
        .volume-control {
            position: absolute;
            bottom: 50px;
            right: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            color: white;
        }
        
        .volume-slider {
            appearance: none;
            width: 100px;
            height: 5px;
            background: #555;
            outline: none;
            transform: rotate(-90deg);
            margin: 20px 0;
        }
        
        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 15px;
            height: 15px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .volume-label {
            font-size: 12px;
            color: #aaa;
        }
        
        /* Lyrics Panel Styles */
        .lyrics-panel {
            width: 280px;
            height: 450px;
            background-color: #1a1a1a;
            border-radius: 10px;
            margin: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
        }
        
        .lyrics-header {
            height: 40px;
            background-color: #222;
            display: flex;
            align-items: center;
            padding: 0 15px;
            border-bottom: 1px solid #333;
        }
        
        .lyrics-title {
            color: white;
            font-size: 16px;
            font-weight: bold;
        }
        
        .lyrics-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            color: #ddd;
            font-size: 14px;
            line-height: 1.6;
            scrollbar-width: thin;
            scrollbar-color: #444 #1a1a1a;
        }
        
        .lyrics-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .lyrics-content::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .lyrics-content::-webkit-scrollbar-thumb {
            background-color: #444;
            border-radius: 6px;
            border: 2px solid #1a1a1a;
        }
        
        .lyrics-line {
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }
        
        .lyrics-line.active {
            color: #00a651;
            font-weight: bold;
        }
        
        .lyrics-timestamp {
            color: #666;
            font-size: 12px;
            margin-right: 5px;
        }
        
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        /* Make windows draggable */
        .window.dragging {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="desktop">
        <div class="desktop-icons">
            <div class="icon">
                <a href="https://dinkybeat.github.io/yots.html" target="_blank">
                    <div class="emoji">üëÑ</div>
                    <div class="icon-text">'Tis The Year of the Snitch</div>
                </a>
            </div>
            
            <div class="icon">
                <a href="https://dinkybeat.github.io/broadcast.html" target="_blank">
                    <div class="emoji">üéôÔ∏è</div>
                    <div class="icon-text">Humane Radio Broadcast</div>
                </a>
            </div>

            <div class="icon" id="vinylIcon">
                <div class="emoji">üíø</div>
                <div class="icon-text">Music Player</div>
            </div>
        </div>

        <!-- Folder Window -->
        <div class="window folder-window" id="folderWindow">
            <div class="titlebar" id="folderTitlebar">
                <div class="title">
                    <div class="title-emoji">üìÅ</div>
                    <span>My Documents</span>
                </div>
                <div class="window-controls">
                    <div class="window-button">_</div>
                    <div class="window-button">‚ñ°</div>
                    <div class="window-button close-button" onclick="closeWindow('folderWindow')">‚úï</div>
                </div>
            </div>
            <div class="folder-toolbar">
                <div class="folder-toolbar-section">
                    <div class="folder-toolbar-button">
                        <div class="folder-toolbar-emoji">‚óÄ</div>
                        <span>Back</span>
                    </div>
                    <div class="folder-toolbar-button">
                        <div class="folder-toolbar-emoji">‚ñ∂</div>
                        <span>Forward</span>
                    </div>
                </div>
                <div class="folder-toolbar-section">
                    <div class="folder-toolbar-button">
                        <div class="folder-toolbar-emoji">üîç</div>
                        <span>Search</span>
                    </div>
                    <div class="folder-toolbar-button">
                        <div class="folder-toolbar-emoji">üìÅ</div>
                        <span>Folders</span>
                    </div>
                </div>
            </div>
            <div class="folder-addressbar">
                <div class="folder-addressbar-label">Address:</div>
                <div class="folder-addressbar-path">C:\Documents and Settings\Administrator\My Documents</div>
            </div>
            <div class="folder-main">
                <div class="folder-sidebar">
                    <div class="folder-sidebar-section">
                        <div class="folder-sidebar-header">System Tasks</div>
                        <div class="folder-sidebar-item">
                            <div class="folder-sidebar-emoji">üíª</div>
                            <span>My Computer</span>
                        </div>
                        <div class="folder-sidebar-item">
                            <div class="folder-sidebar-emoji">üìÇ</div>
                            <span>My Documents</span>
                        </div>
                        <div class="folder-sidebar-item">
                            <div class="folder-sidebar-emoji">üñºÔ∏è</div>
                            <span>My Pictures</span>
                        </div>
                        <div class="folder-sidebar-item">
                            <div class="folder-sidebar-emoji">üéµ</div>
                            <span>My Music</span>
                        </div>
                    </div>
                    <div class="folder-sidebar-section">
                        <div class="folder-sidebar-header">Other Places</div>
                        <div class="folder-sidebar-item">
                            <div class="folder-sidebar-emoji">üè†</div>
                            <span>Desktop</span>
                        </div>
                        <div class="folder-sidebar-item">
                            <div class="folder-sidebar-emoji">üåê</div>
                            <span>Shared Documents</span>
                        </div>
                        <div class="folder-sidebar-item">
                            <div class="folder-sidebar-emoji">üóëÔ∏è</div>
                            <span>Recycle Bin</span>
                        </div>
                    </div>
                </div>
                <div class="folder-content">
                    <!-- Text files with data attributes for notepad content -->
                    <div class="folder-file" data-filename="About Me.txt" data-content="Your system. Your rules. PanesOS is still in development. Check back soon!">
                        <div class="folder-file-emoji">üìÑ</div>
                        <div class="folder-file-name">About Me.txt</div>
                    </div>
                    <div class="folder-file" data-filename="Projects.txt" data-content="Check back soon!">
                        <div class="folder-file-emoji">üìÑ</div>
                        <div class="folder-file-name">Projects.txt</div>
                    </div>
                    
                    <div class="folder-file" data-filename="Contact Info.txt" data-content="Out of sight. Out of mind.">
                        <div class="folder-file-emoji">üìÑ</div>
                        <div class="folder-file-name">Contact Info.txt</div>
                    </div>
                </div>
            </div>
            <div class="folder-statusbar">
                3 items
            </div>
        </div>

        <!-- Vinyl Player Window (styling unchanged) -->
<div class="window vinyl-window" id="vinylWindow">
  <div class="titlebar" id="vinylTitlebar">
    <div class="title">
      <div class="title-emoji">üíø</div>
      <span>Vinyl Player - Death Grips</span>
    </div>
    <div class="window-controls">
      <div class="window-button">_</div>
      <div class="window-button">‚ñ°</div>
      <div class="window-button close-button" onclick="closeWindow('vinylWindow')">‚úï</div>
    </div>
  </div>

  <div class="vinyl-container">
    <!-- GLITCH OVERLAY for random lines/flickers -->
    <div id="vinylGlitchOverlay"
         style="
           pointer-events: none;
           position: absolute;
           top: 0; left: 0;
           width: 100%;
           height: 100%;
           z-index: 999;
           overflow: hidden;
         ">
    </div>

    <!-- FATAL ERROR OVERLAY -->
    <div id="vinylFatalError"
         style="
           pointer-events: none;
           position: absolute;
           top: 0; left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.8);
           color: #f00;
           display: flex;
           align-items: center;
           justify-content: center;
           text-align: center;
           font-size: 2em;
           opacity: 0;
           transition: opacity 0.5s;
           z-index: 1000;
         ">
      <p style="
           margin: 0;
           padding: 20px;
           background: #400;
           border: 2px solid #f00;
           text-shadow: 2px 2px 0 #000;">
        FATAL ERROR<br>TRANSMISSION LOST
      </p>
    </div>

    <div class="player-container">
      <div class="turntable" id="turntable">
        <div class="player-base"></div>
        <div class="platter">
          <div class="record" id="record">
            <div class="record-label"
                 style="background-image: url('https://i.discogs.com/WMrtONp2OVLav9NCqkz-lx0bmtycv7cVwIqSbL0aevo/rs:fit/g:sm/q:90/h:600/w:598/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTI2OTcw/MTg1LTE2OTcyNjAx/NzItMTQyNi5qcGVn.jpeg');">
            </div>
          </div>
          <div class="record-center"></div>
        </div>
        <div class="tonearm-base"></div>
        <div class="tonearm" id="tonearm">
          <div class="cartridge"></div>
        </div>
        <div class="controls">
          <button class="control-button play-button" id="playButton">‚ñ∂</button>
          <button class="control-button" id="stopButton">‚ñ†</button>
        </div>
        <div class="volume-control">
          <span class="volume-label">Volume</span>
          <input type="range" min="0" max="100" value="80" class="volume-slider" id="volumeSlider">
        </div>
      </div>
      <div class="album-display">
        <div class="album-cover"
             style="background-image: url('https://i.discogs.com/WMrtONp2OVLav9NCqkz-lx0bmtycv7cVwIqSbL0aevo/rs:fit/g:sm/q:90/h:600/w:598/czM6Ly9kaXNjb2dz/LWRhdGFiYXNlLWlt/YWdlcy9SLTI2OTcw/MTg1LTE2OTcyNjAx/NzItMTQyNi5qcGVn.jpeg');">
        </div>
      </div>
      <div class="album-info" id="albumInfo">
        <div class="album-title">Beware</div>
        <div class="album-artist">Death Grips</div>
      </div>
    </div>

    <!-- Lyrics Panel (unchanged) -->
    <div class="lyrics-panel">
      <div class="lyrics-header">
        <div class="lyrics-title">Beware - Lyrics</div>
      </div>
      <div class="lyrics-content" id="lyricsContent">
        <!-- Lyrics lines will be added by JavaScript -->
      </div>
    </div>
  </div>

  <!-- MAIN TRACK -->
  <audio id="audioPlayer" src="https://dinkybeat.github.io/media/audio/Beware.mp3" preload="auto"></audio>
  <!-- NEW: Whisper & Static Audio for layering -->
  <audio id="whisperAudio" src="whisper1.mp3" preload="auto"></audio>
  <audio id="staticAudio" src="static1.mp3" preload="auto"></audio>
</div>

<script>
/* =======================
   VINYL PLAYER HORROR LOGIC
   ======================= */

// Grab references to new elements
const vinylGlitchOverlay = document.getElementById('vinylGlitchOverlay');
const vinylFatalError = document.getElementById('vinylFatalError');
const whisperAudio = document.getElementById('whisperAudio');
const staticAudio = document.getElementById('staticAudio');
const albumInfo = document.getElementById('albumInfo');

// Keep track of whether the track ended once
let reversedPlayback = false;

// Hook into the existing 'ended' event of audioPlayer
audioPlayer.addEventListener('ended', function() {
  // If this is the first end, reverse playback
  if (!reversedPlayback) {
    reversedPlayback = true;
    reversePlayback();
  } else {
    // If it ends again, show fatal error overlay
    vinylFatalError.style.opacity = '1';
    vinylFatalError.style.pointerEvents = 'auto';
  }
});

// Reverse playback by setting negative playbackRate if supported
function reversePlayback() {
  pauseRecord(); // Assumes pauseRecord() is defined in your existing vinyl player code
  audioPlayer.currentTime = audioPlayer.duration - 0.1;
  try {
    audioPlayer.playbackRate = -1;
    audioPlayer.play().catch(()=>{});
    playRecordUI(); // Update UI to reflect playing state
  } catch (err) {
    console.warn('Reverse playback not supported, falling back to replay from start.');
    audioPlayer.playbackRate = 1;
    audioPlayer.currentTime = 0;
    audioPlayer.play();
    playRecordUI();
  }
}

// Update the UI to show the record is playing
function playRecordUI() {
  record.classList.add('playing');
  tonearm.classList.add('playing');
  playButton.innerHTML = '‚ùö‚ùö';
  isPlaying = true;
  updateLyricsInterval = setInterval(updateLyrics, 100);
}

// RANDOM PITCH SHIFT every few seconds
setInterval(() => {
  if (isPlaying && Math.random() < 0.2) {
    const originalRate = audioPlayer.playbackRate;
    const shift = (Math.random() * 0.1) - 0.05; // ¬±0.05
    audioPlayer.playbackRate = originalRate + shift;
    setTimeout(() => {
      audioPlayer.playbackRate = originalRate;
    }, 500);
  }
}, 4000);

// RANDOM WHISPER/STATIC LAYERING
function scheduleWhisperAndStatic() {
  const nextWhisper = 5000 + Math.random() * 10000; // 5-15s
  const nextStatic = 8000 + Math.random() * 12000;  // 8-20s

  setTimeout(() => {
    whisperAudio.currentTime = 0;
    whisperAudio.play().catch(()=>{});
    scheduleWhisperAndStatic();
  }, nextWhisper);

  setTimeout(() => {
    staticAudio.currentTime = 0;
    staticAudio.play().catch(()=>{});
    scheduleWhisperAndStatic();
  }, nextStatic);
}
scheduleWhisperAndStatic();

// GLITCH OVERLAY: random lines or flickers
setInterval(() => {
  if (Math.random() < 0.3) triggerVinylGlitch();
}, 3000);

function triggerVinylGlitch() {
  const line = document.createElement('div');
  line.style.position = 'absolute';
  line.style.width = '100%';
  line.style.height = '2px';
  line.style.background = '#fff';
  line.style.top = Math.floor(Math.random() * 100) + '%';
  line.style.opacity = '0.2';
  vinylGlitchOverlay.appendChild(line);

  setTimeout(() => {
    vinylGlitchOverlay.removeChild(line);
  }, 300);

  // Occasionally glitch the album info text
  if (Math.random() < 0.5) glitchAlbumInfo();
}

// Glitch the album title/artist briefly
function glitchAlbumInfo() {
  const glitchChars = "!@#$%^&*()_+[]{}<>?";
  const titleElem = albumInfo.querySelector('.album-title');
  const artistElem = albumInfo.querySelector('.album-artist');

  const originalTitle = titleElem.textContent;
  const originalArtist = artistElem.textContent;

  function glitchText(str) {
    let result = '';
    for (let c of str) {
      result += (Math.random() < 0.2) ? glitchChars.charAt(Math.floor(Math.random() * glitchChars.length)) : c;
    }
    return result;
  }

  titleElem.textContent = glitchText(originalTitle);
  artistElem.textContent = glitchText(originalArtist);

  setTimeout(() => {
    titleElem.textContent = originalTitle;
    artistElem.textContent = originalArtist;
  }, 500);
}

/* 
  NOTE: This script snippet only covers the new vinyl player horror effects.
  Your existing functionality (draggable windows, notepad, folder window, etc.) remains intact
  as it is part of your overall system code.
*/
</script>

</body>
</html>
